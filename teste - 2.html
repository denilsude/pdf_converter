<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Conversor de PDF em DOCX</title>

  <!-- PDF.js via CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

  <!-- docx.js via CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.4.0/docx.js"></script>

  <style>
    body { font-family: Arial; margin: 20px; }
    textarea { width: 100%; height: 300px; }
  </style>
</head>
<body>
  <h1>Conversor de PDF em Arquivo DOCX</h1>
  <input type="file" id="pdfFile" accept="application/pdf" />
  <button onclick="convertPDF()">Converter e Baixar DOCX</button>
  <h2>Texto Extraído (Pré-visualização):</h2>
  <textarea id="output"></textarea>

  <script>
    // Configurar o caminho do worker do PDF.js
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

    async function convertPDF() {
      const fileInput = document.getElementById('pdfFile');
      const file = fileInput.files[0];
      if (!file) {
        alert('Selecione um arquivo PDF.');
        return;
      }

      const reader = new FileReader();
      reader.onload = async function() {
        const typedarray = new Uint8Array(this.result);
        const pdf = await pdfjsLib.getDocument({ data: typedarray }).promise;
        let allText = '';

        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const content = await page.getTextContent();
          const strings = content.items.map(item => item.str);
          allText += strings.join(' ') + '\n\n';
        }

        document.getElementById('output').value = allText;

        // Criar o documento DOCX usando classes globais
        const doc = new Document({
          sections: [
            {
              properties: {},
              children: [
                new Paragraph({
                  children: [
                    new TextRun({
                      text: allText,
                      font: "Arial",
                      size: 24
                    })
                  ]
                })
              ]
            }
          ]
        });

        // Gerar e baixar o arquivo
        const packer = new Packer();
        const blob = await packer.toBlob(doc);
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.href = url;
        link.download = "documento_convertido.docx";
        link.click();
        URL.revokeObjectURL(url);
      };
      reader.readAsArrayBuffer(file);
    }
  </script>
</body>
</html>
